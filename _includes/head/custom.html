{% include base_path %}

<!-- start custom head snippets -->
{% if page.use_math %}
  {% include mathjax_support.html %}
{% endif %}
<!-- Academicons (place file at /assets/css/academicons.css) -->
<link rel="stylesheet" href="{{ base_path }}/assets/css/academicons.css"/>

<!-- Favicons & PWA -->
<link rel="apple-touch-icon" sizes="180x180" href="{{ base_path }}/images/apple-touch-icon-180x180.png"/>
<link rel="icon" type="image/svg+xml" href="{{ base_path }}/images/favicon.svg"/>
<link rel="icon" type="image/png" href="{{ base_path }}/images/favicon-32x32.png" sizes="32x32"/>
<link rel="icon" type="image/png" href="{{ base_path }}/images/favicon-192x192.png" sizes="192x192"/>
<link rel="icon" href="{{ base_path }}/images/favicon.ico"/>
<link rel="manifest" href="{{ base_path }}/images/manifest.json"/>
<meta name="theme-color" content="#ffffff"/>

<!-- end custom head snippets -->

{% if page.use_plotly or page.use_math or page.use_mermaid %}
<script>
  // Lightweight loader with optional onload callback
  function loadScript(src, { type = "text/javascript", defer = true, async = false, onload = null } = {}) {
    const s = document.createElement('script');
    s.src = src;
    s.type = type;
    s.defer = defer;
    s.async = async;
    if (onload) s.onload = onload;
    document.body.appendChild(s);
  }

  document.addEventListener("DOMContentLoaded", function() {
    // Plotly — only if requested
    {% if page.use_plotly %}
      loadScript("https://cdn.plot.ly/plotly-3.0.1.min.js");
    {% endif %}

    // MathJax v3 — only if explicitly enabled
    {% if page.use_math %}
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          tags: 'ams'
        },
        options: {
          skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      };
      loadScript("https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js");
    {% endif %}

    // Mermaid — load UMD build and initialize
    {% if page.use_mermaid %}
      loadScript(
        "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js",
        {
          onload: function () {
            if (window.mermaid && typeof window.mermaid.initialize === "function") {
              window.mermaid.initialize({ startOnLoad: true });
            }
          }
        }
      );
    {% endif %}
  });
</script>
{% endif %}
