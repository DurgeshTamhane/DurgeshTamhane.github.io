{% if page.use_plotly or page.use_math or page.use_mermaid %}
<script>
  function loadScript(src, type="text/javascript") {
    let s = document.createElement('script');
    s.src = src;
    s.type = type;
    s.defer = true;
    document.body.appendChild(s);
  }

  document.addEventListener("DOMContentLoaded", function() {
    // Load Plotly only if requested
    {% if page.use_plotly %}
    loadScript("https://cdn.plot.ly/plotly-3.0.1.min.js");
    {% endif %}

    // Load MathJax only if explicitly enabled
    {% if page.use_math %}
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        tags: 'ams'
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    };
    loadScript("https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js");
    {% endif %}

    // Load Mermaid only if requested
    {% if page.use_mermaid %}
    loadScript("https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs", "module");
    {% endif %}
  });
</script>
{% endif %}
